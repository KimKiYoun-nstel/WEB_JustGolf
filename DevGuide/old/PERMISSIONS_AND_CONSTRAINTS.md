# ê¶Œí•œ ë° ì œì•½ ì¡°ê±´ ë¶„ì„

**ì‘ì„±ì¼**: 2026-02-11  
**ìƒíƒœ**: ğŸ”´ ê°œì„  í•„ìš”

---

## 1. í˜„ì¬ ìƒíƒœ ì •ë¦¬

### 1.1 ëŒ€íšŒ (Tournament) ìƒíƒœ

ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ìƒíƒœ:
```
'draft'   â†’ ì‘ì„±ì¤‘ (ì•„ì§ ê³µê°œ ì•ˆ ë¨)
'open'    â†’ ëª¨ì§‘ì¤‘ (ì‹ ì²­ ë°›ìŒ)
'closed'  â†’ ë§ˆê° (ì‹ ì²­ ì¢…ë£Œ)
'done'    â†’ ì¢…ë£Œ (ëŒ€íšŒ ì™„ë£Œ)
```

**í˜„ì¬ ë¬¸ì œ**: âŒ **ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ê¸°ëŠ¥ ë™ì‘**
```
ì˜ˆ: draft ìƒíƒœì¸ ëŒ€íšŒì—ë„ ì‹ ì²­ ê°€ëŠ¥ (ì˜ìƒ ì•ˆ í•¨)
ì˜ˆ: closed ìƒíƒœì¸ë°ë„ ì •ë³´ ìˆ˜ì • ê°€ëŠ¥
```

---

## 2. ì‚­ì œ ê¸°ëŠ¥ í˜„í™©

### 2.1 âœ… ì¡´ì¬í•˜ëŠ” ì‚­ì œ
| ëŒ€ìƒ | ì£¼ì²´ | ê¸°ëŠ¥ | ìœ„ì¹˜ |
|------|------|------|------|
| **ì‹ ì²­ ì •ë³´** | ë³¸ì¸ ë˜ëŠ” ê´€ë¦¬ì | `deleteParticipant()` | `app/t/[id]/page.tsx` |
| **íŒŒì¼** | ê´€ë¦¬ìë§Œ | RLS ì •ì±…: `admin_delete_tournament_files` | DB |
| **ë¼ìš´ë“œ** | ê´€ë¦¬ì | `deleteSideEvent()` | `lib/sideEventService.ts` |

### 2.2 âŒ ì—†ëŠ” ì‚­ì œ (êµ¬í˜„ í•„ìš”)

| ëŒ€ìƒ | ì˜ë„ | ê¸°ëŠ¥ | ì™œ? |
|------|------|------|------|
| **ê²Œì‹œíŒ ê¸€** | ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ì | - | ì‚¬ìš©ìê°€ ì“´ ê¸€ì€ ì‚­ì œ ê¶Œë¦¬ ìˆì–´ì•¼ í•¨ |
| **ëŒ€íšŒ** | ê´€ë¦¬ìë§Œ | - | ê´€ë¦¬ìê°€ ëŒ€íšŒ ì·¨ì†Œ/ì‚­ì œí•  ìˆ˜ ìˆì–´ì•¼ í•¨ |
| **íˆ¬ì–´ë„ˆë¨¼íŠ¸ íŒŒì¼** | ê´€ë¦¬ì UI ì œê³µ | - | RLS ì •ì±…ì€ ìˆì§€ë§Œ UI ì—†ìŒ |

---

## 3. ëŒ€íšŒ ìƒíƒœë³„ ê¶Œí•œ/ì œì•½ (í˜„ì¬ VS ê¶Œì¥)

### 3.1 ì‹ ì²­ (Apply)

| ìƒíƒœ | í˜„ì¬ | ê¶Œì¥ | ë¹„ê³  |
|------|------|------|------|
| **draft** | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ | ì•„ì§ ê³µê°œ ì•ˆ ë¨, ì‹ ì²­ ë°›ìœ¼ë©´ ì•ˆ ë¨ |
| **open** | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ | ì •ìƒ ì‹ ì²­ ì‹œê¸° |
| **closed** | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ | ëª¨ì§‘ ì¢…ë£Œ, ì‹ ì²­ ì°¨ë‹¨ |
| **done** | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ | ëŒ€íšŒ ì™„ë£Œ, ì‹ ì²­ ì°¨ë‹¨ |

**ê²°ë¡ **: í˜„ì¬ëŠ” ìƒíƒœ ì²´í¬ ì—†ìŒ â†’ **ìƒíƒœ ê¸°ë°˜ ê²€ì¦ í•„ìš”**

---

### 3.2 ì‹ ì²­ ì •ë³´ ìˆ˜ì • (Update Registration)

| ìƒíƒœ | í˜„ì¬ | ê¶Œì¥ | ë¹„ê³  |
|------|------|------|------|
| **draft** | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ | ì•„ì§ ê³µê°œ ì•ˆ ë¨ |
| **open** | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ | ìˆ˜ì • ê°€ëŠ¥ ì‹œê¸° |
| **closed** | âœ… ê°€ëŠ¥ | â“ ì œí•œì  | ëª¨ì§‘ ì¢…ë£Œ í›„ ìˆ˜ì • ê°€ëŠ¥ ì—¬ë¶€? |
| **done** | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ | ëŒ€íšŒ ì™„ë£Œ, ìˆ˜ì • ì°¨ë‹¨ |

**ê³ ë ¤ì‚¬í•­**:
- closed ìƒíƒœì—ì„œ ìˆ˜ì •ì„ ì°¨ë‹¨í• ì§€, ê³µê°œ ì •ë³´ë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ í• ì§€?
- í†µìƒ *í˜„í™© ì •ë³´ë³´ê¸°*ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ì‹ ì²­ ìˆ˜ì •ì€ ì°¨ë‹¨

---

### 3.3 í˜„í™© ì •ë³´ í™•ì¸ (View Participants)

| ìƒíƒœ | í˜„ì¬ | ê¶Œì¥ | ë¹„ê³  |
|------|------|------|------|
| **draft** | âœ… ê³µê°œ | âŒ ì°¨ë‹¨ | ì•„ì§ ë¹„ê³µê°œ |
| **open** | âœ… ê³µê°œ | âœ… ê³µê°œ | ì •ìƒ ì¡°íšŒ |
| **closed** | âœ… ê³µê°œ | âœ… ê³µê°œ | ìµœì¢… í˜„í™© ì¡°íšŒ |
| **done** | âœ… ê³µê°œ | âœ… ê³µê°œ | ì‚¬í›„ í˜„í™© ì¡°íšŒ |

---

### 3.4 ë¼ìš´ë“œ ì‹ ì²­ / ì‹ì‚¬ ì„ íƒ ë“±

| ê¸°ëŠ¥ | draft | open | closed | done |
|------|-------|------|--------|------|
| ë¼ìš´ë“œ ì‹ ì²­ | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ | âŒ ë¶ˆê°€ |
| ì‹ì‚¬ ì„ íƒ | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ | â“ ê°€ëŠ¥? | âŒ ë¶ˆê°€ |
| ì¹´í’€/í™œë™ ì„ íƒ | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ | â“ ê°€ëŠ¥? | âŒ ë¶ˆê°€ |

---

## 4. RLS ì •ì±… í˜„í™©

### 4.1 Tournaments í…Œì´ë¸”

```sql
-- ëª¨ë‘ ì½ê¸° ê°€ëŠ¥ (ìƒíƒœ ë¬´ê´€)
SELECT: true (ëª¨ë‘)

-- ê´€ë¦¬ìë§Œ ì“°ê¸°
INSERT/UPDATE/DELETE: admin ê¶Œí•œë§Œ
```

**ë¬¸ì œ**: SELECT ì •ì±…ì—ì„œ `status` í™•ì¸ ì—†ìŒ
â†’ draft ìƒíƒœë„ ëª¨ë‘ ì¡°íšŒ ê°€ëŠ¥

---

### 4.2 Registrations í…Œì´ë¸”

```sql
-- ëª¨ë‘ ì½ê¸° ê°€ëŠ¥
SELECT: true (ëª¨ë‘)

-- ë³¸ì¸ë§Œ ì‚½ì…/ìˆ˜ì •
INSERT: user_id = auth.uid()
UPDATE: user_id = auth.uid()

-- ê´€ë¦¬ìë„ ìˆ˜ì • ê°€ëŠ¥
UPDATE: admin also allowed
```

**ë¬¸ì œ**: ìƒíƒœ ê¸°ë°˜ ê²€ì¦ ì—†ìŒ
â†’ closed ìƒíƒœì—ì„œë„ INSERT/UPDATE ê°€ëŠ¥

---

### 4.3 Tournament_files í…Œì´ë¸”

```sql
-- Public íŒŒì¼ë§Œ ì½ê¸°
SELECT: is_public = true

-- ê´€ë¦¬ìë§Œ ì‚­ì œ
DELETE: admin only (ì •ì±… ì¡´ì¬)
```

**ì¥ì **: ì •ì±…ì€ ìˆìŒ  
**ë¬¸ì œ**: UIì—ì„œ ì œê³µí•˜ì§€ ì•ŠìŒ

---

## 5. ê²Œì‹œíŒ (Feedbacks) í˜„í™©

### 5.1 í˜„ì¬ ê¸°ëŠ¥

âœ… **ê¸°ëŠ¥ ìˆìŒ**:
- í”¼ë“œë°± ì‘ì„± (ëª¨ë“  ë¡œê·¸ì¸ ì‚¬ìš©ì)
- í”¼ë“œë°± ì¡°íšŒ (ëª¨ë‘)
- ìƒíƒœ ë³€ê²½ (ê´€ë¦¬ìë§Œ - DB ìˆ˜ì¤€)

âŒ **ê¸°ëŠ¥ ì—†ìŒ**:
- í”¼ë“œë°± ì‚­ì œ
- RLS ì •ì±… ê²€ì¦

### 5.2 ê¶Œì¥ ì‚¬í•­

| ê¶Œí•œ | ì‚­ì œ ê°€ëŠ¥ |
|------|---------|
| ì‘ì„±ì | âœ… ìì‹ ì˜ ê¸€ |
| ê´€ë¦¬ì | âœ… ëª¨ë“  ê¸€ |
| ë‹¤ë¥¸ ì‚¬ìš©ì | âŒ ë¶ˆê°€ |

---

## 6. ê°œì„  ìš°ì„ ìˆœìœ„

### ğŸ”´ Critical (í•„ìˆ˜)

1. **ëŒ€íšŒ ìƒíƒœë³„ ì‹ ì²­ ì œì•½**
   - `draft`, `closed`, `done` ìƒíƒœì—ì„œëŠ” ì‹ ì²­ ë¶ˆê°€
   - í”„ë¡ íŠ¸ì—”ë“œ + RLS ì •ì±… í•„ìš”

2. **ê²Œì‹œíŒ ê¸€ ì‚­ì œ**
   - ì‘ì„±ìë§Œ ì‚­ì œ ê°€ëŠ¥
   - RLS ì •ì±… + UI ë²„íŠ¼

### ğŸŸ¡ High (ê¶Œì¥)

3. **ëŒ€íšŒ ìƒíƒœë³„ ì •ë³´ ìˆ˜ì • ì œì•½**
   - `done` ìƒíƒœì—ì„œëŠ” ìˆ˜ì • ë¶ˆê°€
   - `closed` ìƒíƒœëŠ” ìƒí™©ì— ë”°ë¼ ê²°ì •

4. **ëŒ€íšŒ ìƒíƒœë³„ í˜„í™© ë³´ê¸° ì œì•½**
   - `draft` ìƒíƒœëŠ” êµ¬ì„±ì›(ë“±ë¡ì)ë§Œ ë³´ê¸°
   - ë˜ëŠ” ì•„ì˜ˆ ì°¨ë‹¨

5. **ëŒ€íšŒ ì‚­ì œ ê¸°ëŠ¥**
   - ê´€ë¦¬ìë§Œ `draft` ìƒíƒœì¸ ëŒ€íšŒë§Œ ì‚­ì œ ê°€ëŠ¥
   - ë˜ëŠ” soft delete (ìƒíƒœ 'deleted')

### ğŸŸ¢ Medium (í¸ì˜)

6. **íŒŒì¼ ì‚­ì œ UI**
   - ì •ì±…ì€ ìˆìœ¼ë‹ˆ UI ì¶”ê°€

7. **ë¼ìš´ë“œ/ì‹ì‚¬ ì„ íƒ ì œì•½**
   - `closed`, `done` ìƒíƒœì—ì„œ ì°¨ë‹¨

---

## 7. êµ¬í˜„ ì˜ˆì‹œ

### 7.1 frontendì—ì„œ ìƒíƒœ ì²´í¬

```typescript
// app/t/[id]/page.tsx - apply() í•¨ìˆ˜
const apply = async () => {
  // ...
  
  // âŒ í˜„ì¬: ì²´í¬ ì—†ìŒ
  const { data, error } = await supabase
    .from("registrations")
    .insert({ ... })
  
  // âœ… ê¶Œì¥: ìƒíƒœ í™•ì¸
  if (!t) return;
  if (t.status !== 'open') {
    setMsg('ëª¨ì§‘ì´ ì¢…ë£Œëœ ëŒ€íšŒì…ë‹ˆë‹¤.');
    return;
  }
  
  const { data, error } = await supabase
    .from("registrations")
    .insert({ ... })
};
```

### 7.2 RLS ì •ì±…ì—ì„œ ìƒíƒœ ì²´í¬

```sql
-- Registrations INSERT ì •ì±… ì¶”ê°€
DROP POLICY IF EXISTS "registrations_insert_open" ON registrations;
CREATE POLICY "registrations_insert_open"
ON registrations FOR INSERT
WITH CHECK (
  auth.uid() = user_id
  AND
  -- ëŒ€íšŒ ìƒíƒœê°€ 'open'ì¸ì§€ í™•ì¸
  (SELECT status FROM tournaments WHERE id = tournament_id) = 'open'
);
```

### 7.3 ê²Œì‹œíŒ ê¸€ ì‚­ì œ

```sql
-- Feedbacks í…Œì´ë¸”ì— RLS ì •ì±… ì¶”ê°€
DROP POLICY IF EXISTS "feedbacks_delete_own" ON feedbacks;
CREATE POLICY "feedbacks_delete_own"
ON feedbacks FOR DELETE
USING (
  auth.uid() = user_id
  OR public.is_admin(auth.uid())
);
```

---

## 8. ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 8.1 Soft Delete vs Hard Delete

```
ëŒ€íšŒ ì‚­ì œ:
  - Hard: ëª¨ë“  ë°ì´í„° ì‚­ì œ (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)
  - Soft: status = 'deleted'ë¡œ í‘œì‹œë§Œ í•¨ (ê¶Œì¥)

ì´ìœ :
  - ê°ì‚¬ ë¡œê·¸ ìœ ì§€ë˜ì–´ì•¼ í•¨
  - ì‹¤ìˆ˜ ë³µêµ¬ ê°€ëŠ¥
  - ë²•ì  ê¸°ë¡ í•„ìš”í•  ìˆ˜ ìˆìŒ
```

### 8.2 í™œë™ ì •ë³´ ì™„ì„±ë„

```
í˜„ì¬:
  - ì‹ ì²­ìë§Œ í˜„í™© ì¡°íšŒ ê°€ëŠ¥ âœ…
  - ëŒ€íšŒê°€ ê³µê°œë˜ì–´ì•¼ í•¨ (draftëŠ” ì•ˆ ë¨) âŒ

ê¶Œì¥:
  - draft: êµ¬ì„±ì›(ë“±ë¡ì)ë§Œ ë³´ê¸°
  - open/closed/done: ëª¨ë‘ ë³´ê¸°
```

### 8.3 ê¶Œë¦¬ ê¸°ë°˜ ì ‘ê·¼ (RBAC)

```
í˜„ì¬ ì—­í• :
  - ì¼ë°˜ ì‚¬ìš©ì (is_admin = false)
  - ê´€ë¦¬ì (is_admin = true)

í–¥í›„ ê³ ë ¤:
  - ëŒ€íšŒ ë§¤ë‹ˆì € (íŠ¹ì • ëŒ€íšŒ ìš´ì˜ê¶Œ)
  - ì½”ìŠ¤ ê´€ë¦¬ì (ì½”ìŠ¤ë³„ ê¶Œí•œ)
```

---

## 9. ë³€ê²½ ì˜í–¥ë„

### íŒŒì¼ë³„ ìˆ˜ì • í•„ìš”

| íŒŒì¼ | ë³€ê²½ | ì˜í–¥ë„ |
|------|------|--------|
| `app/t/[id]/page.tsx` | ìƒíƒœ ì²´í¬ ì¶”ê°€ | High |
| `db/migrations/XXX.sql` | RLS ì •ì±… ì¶”ê°€ | Critical |
| `app/board/page.tsx` | ì‚­ì œ ë²„íŠ¼ + í•¨ìˆ˜ | Medium |
| `supabase/migrations/XXX.sql` | Feedbacks RLS | Medium |

---

## 10. ë‹¤ìŒ ë‹¨ê³„

1. **ë¨¼ì € í™•ì¸**:
   - closed ìƒíƒœì—ì„œ ì •ë³´ ìˆ˜ì •ì„ ì°¨ë‹¨í• ì§€, ê³µê°œ ì •ë³´ë§Œ ìˆ˜ì •í• ì§€?
   - ëŒ€íšŒ ì‚­ì œëŠ” hard delete ë˜ëŠ” soft delete?
   - ê²Œì‹œíŒ ê¸€ ì‚­ì œ ê¶Œí•œì€?

2. **êµ¬í˜„ ìˆœì„œ** (ê¶Œì¥):
   1. ëŒ€íšŒ ìƒíƒœë³„ ì‹ ì²­ ì œì•½ (Frontend + RLS)
   2. ê²Œì‹œíŒ ê¸€ ì‚­ì œ (Frontend + RLS)
   3. ëŒ€íšŒ ì‚­ì œ ê¸°ëŠ¥ (UI + Backend)
   4. ì¶”ê°€ ì œì•½ë“¤ (ì°¨ë‹¨ ëŠë‚„ ì •ë„)

---

## ì°¸ê³ 

- **ëŒ€íšŒ ìƒíƒœ**: `draft`, `open`, `closed`, `done`
- **í˜„ì¬ RLS ì •ì±…**: `db/schema.sql` + `supabase/migrations/`
- **UI ì»´í¬ë„ŒíŠ¸**: ëª¨ë‘ `components/ui/` ë˜ëŠ” ì „ìš© í˜ì´ì§€
