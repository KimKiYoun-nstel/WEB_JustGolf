# 라이브 추첨 완료 계약서 (사용자 기준 + 구현 기준)

최종 수정일: 2026-02-13  
적용 범위: `admin/tournaments/[id]/draw` 라이브 추첨 애니메이션 (`LottoAnimator`, Pixi + Matter.js)

## 1. 사용자 수용 기준 (절대 기준)
아래 항목은 모두 충족되어야 한다. 하나라도 실패하면 상태는 `미완료`다.

1. 애니메이션은 항상 실제로 보여야 한다.
- 빈 캔버스 금지
- 기계가 반쯤 잘려 보이는 상태 금지
- 공이 사라지거나 일부만 보이는 상태 금지

2. 비주얼 품질은 의도된 형태여야 한다.
- 의미 없는 임시 도형(placeholder) 금지
- 당첨 공과 기계 파츠가 어색하게 겹치는 상태 금지
- 당첨 공은 전용 도킹 위치에 정확히 안착해야 함

3. 애니메이션 단계는 실제 상태와 정확히 일치해야 한다.
- `configured`: 회전/혼합 진행
- `picked`: 감속 후 당첨 선택
- `confirmed`: 완전 정지, 다음 스텝 전 재회전 금지

4. 결과 일치성이 정확해야 한다.
- 화면상 당첨 공, 하이라이트 후보, 하단 당첨 텍스트가 동일 인물이어야 함

5. 전환 안정성이 보장되어야 한다.
- `다음 스텝`, `배정 확정`, `되돌리기` 시 깜빡임/리셋 점프 금지

6. 운영 UX가 실사용 가능해야 한다.
- 컨트롤 조작과 애니메이션 확인을 위해 반복 스크롤 왕복이 과도하면 실패
- PC 뷰포트 기준 핵심 컨트롤 + 핵심 애니메이션 영역이 실사용 가능한 배치여야 함

## 2. 100% 구현 정의 (엔지니어 의도 기준)
아래 설계가 코드/화면에서 동일하게 성립해야 한다.

1. 기술 스택
- 렌더링: PixiJS
- 물리: Matter.js
- 상태 단일 소스: draw phase/event(reducer state)

2. 레이어 모델
- `bgLayer`: 배경/패널
- `machineLayer`: 기계 본체(정적 요소)
- `actorLayer`: 물리 공/이동 객체
- `fxLayer`: 강조/버스트 이펙트
- `uiLayer`: 상태 텍스트/배너

3. 타임라인 모델
- StepConfigured 수신: 후보 공 재구성, 필요 시 회전 시작
- PickResult 수신: 감속 후 당첨 공 선택
- AssignConfirmed 수신: 도킹 완료 후 다음 스텝 전까지 안정 유지

4. 지오메트리 모델
- 모든 핵심 오브젝트는 stage 내부에서 완전히 보여야 함
- 기계와 도킹 좌표가 시각적으로 결합되어야 함
- 반지름/스케일은 stage 폭/높이에 맞춰 자동 clamp

5. 안정성 가드
- `confirmed`/`finished`에서 재회전 금지
- mount/resize race로 빈 캔버스가 되지 않아야 함

## 3. 완료 체크리스트 (ALL PASS 필수)

1. 시각 검수
- 기준: 잘림 없음, 임시 도형 없음, 도킹 정렬 정상
- 증거: `configured`, `picked`, `confirmed` 스크린샷 각 1장 이상

2. 동작 검수
- 기준: 감속/정지가 명확하고 phase와 동기화됨
- 증거: `pick`, `confirm` 전후 연속 캡처

3. 일치성 검수
- 기준: 당첨 공/하단 라인업/당첨 텍스트 동일
- 증거: 동일 스텝 화면 캡처

4. 전환 안정성 검수
- 기준: 단계 전환 시 깜빡임/리셋 점프 없음
- 증거: 전환 구간 캡처

5. 기술 검수
- `npm run build` 통과
- 치명 lint/type 에러 없음
- 단, 기술 검수 통과만으로 완료 처리 금지

## 4. 작업 종료 금지 규칙

1. 체크리스트 항목 중 하나라도 실패하면 작업 종료 금지
2. `build/lint 통과`를 완료 기준으로 사용 금지
3. 사용자 시각 검수 기준 OK 이전 완료 선언 금지
4. 완료 보고 시 체크리스트 항목별 PASS 근거를 함께 제출

## 5. 작업 프로토콜 (강제)

1. 구현 -> 사용자 기준/체크리스트 검증 -> 미달 항목 재작업
2. 임시 증상 회피 패치만으로 종료 금지
3. 완료 보고는 본 문서 항목 번호를 근거로 작성

## 6. 현재 상태

현재 상태: `미완료`

본 문서 체크리스트가 ALL PASS 되기 전까지 작업을 종료하지 않는다.
